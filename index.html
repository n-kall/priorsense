<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Prior Diagnostics and Sensitivity Analysis • priorsense</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Prior Diagnostics and Sensitivity Analysis">
<meta name="description" content="Provides functions for prior and likelihood sensitivity analysis in Bayesian models. Currently it implements methods to determine the sensitivity of the posterior to power-scaling perturbations of the prior and likelihood.">
<meta property="og:description" content="Provides functions for prior and likelihood sensitivity analysis in Bayesian models. Currently it implements methods to determine the sensitivity of the posterior to power-scaling perturbations of the prior and likelihood.">
<meta property="og:image" content="https://n-kall.github.io/priorsense/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">priorsense</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/powerscaling.html">Power-scaling sensitivity analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="priorsense">priorsense<a class="anchor" aria-label="anchor" href="#priorsense"></a>
</h1>
</div>
<!-- badges: start -->

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>priorsense provides tools for prior diagnostics and sensitivity analysis.</p>
<p>It currently includes functions for performing power-scaling sensitivity analysis on Stan models. This is a way to check how sensitive a posterior is to perturbations of the prior and likelihood and diagnose the cause of sensitivity. For efficient computation, power-scaling sensitivity analysis relies on Pareto smoothed importance sampling (Vehtari et al., 2024) and importance weighted moment matching (Paananen et al., 2021).</p>
<p>Power-scaling sensitivity analysis and priorsense are described in Kallioinen et al. (2023).</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Download the stable version from CRAN with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"priorsense"</span><span class="op">)</span></span></code></pre></div>
<p>Download the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"n-kall/priorsense"</span>, ref <span class="op">=</span> <span class="st">"development"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>priorsense works with models created with rstan, cmdstanr or brms, or with draws objects from the posterior package.</p>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>Consider a simple univariate model with unknown mu and sigma fit to some data y (available via<code>example_powerscale_model("univariate_normal")</code>):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; N;</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="dt">array</span>[N] <span class="dt">real</span> y;</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>}</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="dt">real</span> mu;</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>}</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>  <span class="kw">target +=</span> normal_lpdf(mu | <span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  <span class="kw">target +=</span> normal_lpdf(sigma | <span class="dv">0</span>, <span class="fl">2.5</span>);</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  <span class="co">// likelihood</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>  <span class="kw">target +=</span> normal_lpdf(y | mu, sigma);</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>}</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="kw">generated quantities</span> {</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>  <span class="dt">vector</span>[N] log_lik;</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>  <span class="dt">real</span> lprior;</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>  <span class="co">// log likelihood</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span>:N) log_lik[n] =  normal_lpdf(y[n] | mu, sigma);</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>  <span class="co">// joint log prior</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>  lprior = normal_lpdf(mu | <span class="dv">0</span>, <span class="dv">1</span>) +</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>    normal_lpdf(sigma | <span class="dv">0</span>, <span class="fl">2.5</span>);</span></code></pre></div>
<p>We first fit the model using Stan:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://n-kall.github.io/priorsense/">priorsense</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">normal_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/example_powerscale_model.html">example_powerscale_model</a></span><span class="op">(</span><span class="st">"univariate_normal"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stan.html" class="external-link">stan</a></span><span class="op">(</span></span>
<span>  model_code <span class="op">=</span> <span class="va">normal_model</span><span class="op">$</span><span class="va">model_code</span>,</span>
<span>  data <span class="op">=</span> <span class="va">normal_model</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  refresh <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Once fit, sensitivity can be checked as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/powerscale-sensitivity.html">powerscale_sensitivity</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sensitivity based on cjs_dist:</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span><span class="co">#&gt;   variable prior likelihood diagnosis          </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;              </span></span>
<span><span class="co">#&gt; 1 mu       0.392      0.561 prior-data conflict</span></span>
<span><span class="co">#&gt; 2 sigma    0.290      0.530 prior-data conflict</span></span></code></pre></div>
<p>To visually inspect changes to the posterior, use one of the diagnostic plot functions. Estimates with high Pareto-k values may be inaccurate and are indicated.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/powerscale_plots.html">powerscale_plot_dens</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-dens_plot-1.png" width="70%"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/powerscale_plots.html">powerscale_plot_ecdf</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-ecdf_plot-1.png" width="70%"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/powerscale_plots.html">powerscale_plot_quantities</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-quants_plot-1.png" width="70%"></p>
<p>In some cases, setting <code>moment_match = TRUE</code> will improve the unreliable estimates at the cost of some further computation. This requires the <a href="https://github.com/topipa/iwmm" class="external-link"><code>iwmm</code> package</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Noa Kallioinen, Topi Paananen, Paul-Christian Bürkner, Aki Vehtari (2023). Detecting and diagnosing prior and likelihood sensitivity with power-scaling. Statistics and Computing. 34, 57. <a href="https://doi.org/10.1007/s11222-023-10366-5" class="external-link uri">https://doi.org/10.1007/s11222-023-10366-5</a></p>
<p>Topi Paananen, Juho Piironen, Paul-Christian Bürkner, Aki Vehtari (2021). Implicitly adaptive importance sampling. Statistics and Computing 31, 16. <a href="https://doi.org/10.1007/s11222-020-09982-2" class="external-link uri">https://doi.org/10.1007/s11222-020-09982-2</a></p>
<p>Aki Vehtari, Daniel Simpson, Andrew Gelman, Yuling Yao, Jonah Gabry (2024). Pareto smoothed importance sampling. Journal of Machine Learning Research. 25, 72. <a href="https://jmlr.org/papers/v25/19-556.html" class="external-link uri">https://jmlr.org/papers/v25/19-556.html</a></p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=priorsense" class="external-link">View on CRAN</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing priorsense</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Noa Kallioinen <br><small class="roles"> Author, maintainer, copyright holder </small>  </li>
<li>Topi Paananen <br><small class="roles"> Author </small>  </li>
<li>Paul-Christian Bürkner <br><small class="roles"> Author </small>  </li>
<li>Aki Vehtari <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="https://img.shields.io/badge/lifecycle-stable-green.svg" alt="Lifecycle: stable"></a></li>
<li><a href="https://CRAN.R-project.org/package=priorsense" class="external-link"><img src="https://www.r-pkg.org/badges/version/priorsense" alt="CRAN status"></a></li>
<li><a href="https://github.com/n-kall/priorsense/actions" class="external-link"><img src="https://github.com/n-kall/priorsense/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noa Kallioinen, Topi Paananen, Paul-Christian Bürkner, Aki Vehtari.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
