<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="priorsense">
<title>Power-scaling sensitivity analysis • priorsense</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Power-scaling sensitivity analysis">
<meta property="og:description" content="priorsense">
<meta property="og:image" content="https://n-kall.github.io/priorsense/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">priorsense</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/powerscaling.html">Power-scaling sensitivity analysis</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Power-scaling sensitivity analysis</h1>
            
      
      
      <div class="d-none name"><code>powerscaling.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>priorsense is a package for prior diagnostics in Bayesian models. It
currently implements power-scaling sensitivity analysis but may be
extended in the future to include other diagnostics.</p>
</div>
<div class="section level2">
<h2 id="power-scaling-sensitivity-analysis">Power-scaling sensitivity analysis<a class="anchor" aria-label="anchor" href="#power-scaling-sensitivity-analysis"></a>
</h2>
<p>Power-scaling sensitivity analysis tries to determine how small
changes to the prior or likelihood affect the posterior. This is done by
power-scaling the prior or likelihood by raising it to some <span class="math inline">\(\alpha &gt; 0\)</span>.</p>
<ul>
<li>For prior power-scaling: <span class="math inline">\(p(\theta \mid
y) \propto p(\theta)^\alpha
p(y \mid \theta)\)</span>
</li>
<li>For likelihood power-scaling: <span class="math inline">\(p(\theta
\mid y) \propto
p(\theta) p(y \mid \theta)^\alpha\)</span>
</li>
</ul>
<p>In priorsense, this is done in a computationally efficient manner
using Pareto-smoothed importance sampling (and optionally importance
weighted moment matching) to estimate properties of these perturbed
posteriors. Sensitivity can then be quantified by considering how much
the perturbed posteriors differ from the base posterior.</p>
<div class="section level3">
<h3 id="example-power-scaling-sensitivity-analysis">Example power-scaling sensitivity analysis<a class="anchor" aria-label="anchor" href="#example-power-scaling-sensitivity-analysis"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://n-kall.github.io/priorsense/">priorsense</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan/" class="external-link">rstan</a></span><span class="op">)</span></span></code></pre></div>
<p>Consider the following model (available via
<code>example_powerscale_model("univariate_normal")</code>:</p>
<p><span class="math display">\[y \sim \text{normal}(\mu,
\sigma)\]</span> <span class="math display">\[\mu \sim \text{normal}(0,
1)\]</span> <span class="math display">\[\sigma \sim \text{normal}^+(0,
2.5)\]</span></p>
<p>We have 100 data points for <span class="math inline">\(y\)</span> We
first fit the model using Stan:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; N;</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="dt">real</span> y[N];</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>}</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="dt">real</span> mu;</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>}</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>  <span class="kw">target +=</span> normal_lpdf(mu | <span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>  <span class="kw">target +=</span> normal_lpdf(sigma | <span class="dv">0</span>, <span class="fl">2.5</span>);</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>  <span class="co">// likelihood</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>  <span class="kw">target +=</span> normal_lpdf(y | mu, sigma);</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>}</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="kw">generated quantities</span> {</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>  <span class="dt">vector</span>[N] log_lik;</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>  <span class="co">// likelihood</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>  <span class="dt">real</span> lprior;</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>  <span class="co">// joint prior</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span>:N) log_lik[n] =  normal_lpdf(y[n] | mu, sigma);</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>  lprior = normal_lpdf(mu | <span class="dv">0</span>, <span class="dv">1</span>) + normal_lpdf(sigma | <span class="dv">0</span>, <span class="fl">2.5</span>);</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">normal_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/example_powerscale_model.html">example_powerscale_model</a></span><span class="op">(</span><span class="st">"univariate_normal"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstan/reference/stan.html" class="external-link">stan</a></span><span class="op">(</span></span>
<span>  model_code <span class="op">=</span> <span class="va">normal_model</span><span class="op">$</span><span class="va">model_code</span>,</span>
<span>  data <span class="op">=</span> <span class="va">normal_model</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  refresh <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next, we check the sensitivity of the prior and likelihood to
power-scaling. The sensitivity values shown below are an indication of
how much the posterior changes with respect to power-scaling. Larger
values indicate more sensitivity. By default these values are derived
from the gradient of the Cumulative Jensen-Shannon distance between the
base posterior and posteriors resulting from power-scaling.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/powerscale-sensitivity.html">powerscale_sensitivity</a></span><span class="op">(</span><span class="va">fit</span>, variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span>, <span class="st">"sigma"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: testthat</span></span>
<span><span class="co">#&gt; Sensitivity based on cjs_dist:</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   variable prior likelihood diagnosis          </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> mu       0.433      0.641 prior-data conflict</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> sigma    0.358      0.671 prior-data conflict</span></span></code></pre></div>
<p>Here, we see that the pattern of sensitivity indicates that there is
prior-data conflict for <span class="math inline">\(\mu\)</span>. We
follow up with visualisation.</p>
<p>We first create a <code>powerscaled_sequence</code> object, which
contains estimates of posteriors for a range of power-scaling
amounts.</p>
<p>There are three plots currently available:</p>
<ul>
<li>Kernel density estimates:</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/powerscale_plots.html">powerscale_plot_dens</a></span><span class="op">(</span><span class="va">fit</span>, variable <span class="op">=</span> <span class="st">"mu"</span><span class="op">)</span></span></code></pre></div>
<p><img src="powerscaling_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<ul>
<li>Empirical cumulative distribution functions:</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/powerscale_plots.html">powerscale_plot_ecdf</a></span><span class="op">(</span><span class="va">fit</span>, variable <span class="op">=</span> <span class="st">"mu"</span><span class="op">)</span></span></code></pre></div>
<p><img src="powerscaling_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<ul>
<li>Quantities:</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/powerscale_plots.html">powerscale_plot_quantities</a></span><span class="op">(</span><span class="va">fit</span>, variable <span class="op">=</span> <span class="st">"mu"</span><span class="op">)</span></span></code></pre></div>
<p><img src="powerscaling_files/figure-html/unnamed-chunk-8-1.png" width="1152"></p>
<p>As can be seen in the plots, power-scaling the prior and likelihood
have opposite direction effects on the posterior. This is further
evidence of prior-data conflict.</p>
<p>Indeed, if we inspect the raw data, we see that the prior on <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\text{normal}(0, 1)\)</span> does not match well
with the mean of the data, whereas the prior on <span class="math inline">\(\sigma\)</span>, <span class="math inline">\(\text{normal}^+(0, 2.5)\)</span> is
reasonable:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">normal_model</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 9.844</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">normal_model</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.7697835</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noa Kallioinen, Paul-Christian Bürkner, Topi Paananen, Aki Vehtari.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
